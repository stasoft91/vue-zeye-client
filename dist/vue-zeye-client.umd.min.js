/*!
 * vue-zeye-client v0.1.0 
 * (c) 2020 stasoft91@gmail.com
 * Released under the ISC License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("vue"),require("js-cookie"),require("pokemon"),require("protoo-client"),require("mediasoup-client"),require("hark")):"function"==typeof define&&define.amd?define(["vue","js-cookie","pokemon","protoo-client","mediasoup-client","hark"],t):(e=e||self,e.VueZeyeClient=t(e.Vue,e.jsCookie,e.pokemon,e.protooClient,e.mediasoupClient,e.hark))}(this,function(e,t,r,n,o,a){"use strict";function i(e){for(var t="",r="abcdefghijklmnopqrstuvwxyz0123456789",n=r.length,o=0;o<e;o++)t+=r.charAt(Math.floor(Math.random()*n));return t}function s(e){var t=e.app,r=e.store;t.$zeyeClient.getCurrentRoom=function(){return r.state.zeyeClient.room},t.$zeyeClient.amIActiveSpeaker=function(){return r.state.zeyeClient.me.id===r.state.zeyeClient.room.activeSpeakerId},t.$zeyeClient.isSpeakerActive=function(e){return e===r.state.zeyeClient.room.activeSpeakerId},t.$zeyeClient.setRoomUrl=function(e){e=void 0!==e?e:window.location.href,r.commit("zeyeClient/room/setRoomUrl",{roomUrl:e})}}function c(e){var r=e.displayName;t.set(se,{displayName:r})}function u(){return t.getJSON(ce)}function d(e){var r=e.webcamEnabled;t.set(ce,{webcamEnabled:r})}function l(){return r.random("en")}function p(e){"@babel/helpers - typeof";return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function h(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){function a(e){m(s,n,o,a,i,"next",e)}function i(e){m(s,n,o,a,i,"throw",e)}var s=e.apply(t,r);a(void 0)})}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,r){return t&&v(e.prototype,t),r&&v(e,r),e}function b(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach(function(t){b(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function C(e,t){if(e){if("string"==typeof e)return _(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_(e,t):void 0}}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function k(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=C(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function P(){var e,t=navigator.userAgent,r=Ce.getParser(t);return e=r.satisfies({chrome:">=0",chromium:">=0"})?"chrome":r.satisfies({firefox:">=0"})?"firefox":r.satisfies({safari:">=0"})?"safari":r.satisfies({opera:">=0"})?"opera":r.satisfies({"microsoft edge":">=0"})?"edge":"unknown",{flag:e,name:r.getBrowserName(),version:r.getBrowserVersion()}}function x(e){var t=e.app,r=e.store;t.$zeyeClient.getMe=function(){return r.state.zeyeClient.me},t.$zeyeClient.setMe=function(e,t){e=void 0!==e?e:i(6),t=void 0!==t?t:l(),r.commit("zeyeClient/me/setMe",{peerId:e,displayName:t,device:P()})},t.$zeyeClient.getWebcamState=function(){return t.$zeyeClient.getMe().canSendWebcam?t.$zeyeClient.getVideoProducer()&&"share"!==t.$zeyeClient.getVideoProducer().type?"on":"off":"unsupported"},t.$zeyeClient.canIChangeWebcam=function(){return t.$zeyeClient.getVideoProducer()&&"share"!==t.$zeyeClient.getVideoProducer().type&&t.$zeyeClient.getMe().canChangeWebcam},t.$zeyeClient.getScreenShareState=function(){return t.$zeyeClient.getVideoProducer()&&"share"===t.$zeyeClient.getVideoProducer().type?"on":"off"},t.$zeyeClient.getMicState=function(){return t.$zeyeClient.getMe().canSendMic&&t.$zeyeClient.getAudioProducer()?t.$zeyeClient.getAudioProducer().paused?"off":"on":"unsupported"},t.$zeyeClient.toggleWebcam=function(){"on"===t.$zeyeClient.getWebcamState()?(d({webcamEnabled:!1}),t.$zeyeClient.disableWebcam()):(d({webcamEnabled:!0}),t.$zeyeClient.enableWebcam())},t.$zeyeClient.toggleShare=function(){"on"===t.$zeyeClient.getScreenShareState()?t.$zeyeClient.disableShare():t.$zeyeClient.enableShare()},t.$zeyeClient.toggleMicState=function(){"on"===t.$zeyeClient.getMicState()?t.$zeyeClient.muteMic():t.$zeyeClient.unmuteMic()}}function S(e){var t=e.app,r=e.store;t.$zeyeClient.isConnected=function(){return"connected"===r.state.zeyeClient.room.state},t.$zeyeClient.getGlobalAudioMuted=function(){return r.state.zeyeClient.me.audioMuted},t.$zeyeClient.getVideoVisible=function(e){return Boolean(t.$zeyeClient.getVideoConsumer(e))&&!t.$zeyeClient.getVideoConsumer(e).locallyPaused&&!t.$zeyeClient.getVideoConsumer(e).remotelyPaused}}function z(e){var t=e.app,r=e.store;t.$zeyeClient.getProducers=function(){return r.state.zeyeClient.producers.producers},t.$zeyeClient.getAudioProducer=function(){return t.$zeyeClient.getProducers().find(function(e){return"audio"===e.track.kind})},t.$zeyeClient.getVideoProducer=function(){return t.$zeyeClient.getProducers().find(function(e){return"video"===e.track.kind})}}function M(e){var t=e.app,r=e.store;t.$zeyeClient.getPeers=function(){return r.state.zeyeClient.peers.peers},t.$zeyeClient.getPeer=function(e){return r.state.zeyeClient.peers.peers.find(function(t){return t.id===e})}}function I(e){var t=e.app,r=e.store;t.$zeyeClient.getConsumers=function(){return r.state.zeyeClient.consumers.consumers},t.$zeyeClient.getAudioConsumer=function(e){return t.$zeyeClient.getPeer(e).consumers.map(function(e){return r.state.zeyeClient.consumers.consumers.find(function(t){return t.id===e})}).filter(function(e){return!!e}).find(function(e){return"audio"===e.track.kind})},t.$zeyeClient.getVideoConsumer=function(e){return t.$zeyeClient.getPeer(e).consumers.map(function(e){return r.state.zeyeClient.consumers.consumers.find(function(t){return t.id===e})}).filter(function(e){return!!e}).find(function(e){return"video"===e.track.kind})}}function D(e){var t=e.app,r=e.store;s({app:t,store:r}),x({app:t,store:r}),S({app:t,store:r}),z({app:t,store:r}),I({app:t,store:r}),M({app:t,store:r})}function T(e){var t=e.roomId,r=e.peerId,n=e.forceH264,o=e.forceVP9,a=e.hostname,i=e.protooPort;a=void 0!==a?a:"localhost",i=void 0!==i?i:"4443";var s="wss://".concat(a,":").concat(i,"/?roomId=").concat(t,"&peerId=").concat(r);return n?s="".concat(s,"&forceH264=true"):o&&(s="".concat(s,"&forceVP9=true")),s}function O(e,t,r,n,o,a,i,s,c,u){"boolean"!=typeof i&&(c=s,s=i,i=!1);var d="function"==typeof r?r.options:r;e&&e.render&&(d.render=e.render,d.staticRenderFns=e.staticRenderFns,d._compiled=!0,o&&(d.functional=!0)),n&&(d._scopeId=n);var l;if(a?(l=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,c(e)),e&&e._registeredComponents&&e._registeredComponents.add(a)},d._ssrRegister=l):t&&(l=i?function(){t.call(this,u(this.$root.$options.shadowRoot))}:function(e){t.call(this,s(e))}),l)if(d.functional){var p=d.render;d.render=function(e,t){return l.call(t),p(e,t)}}else{var m=d.beforeCreate;d.beforeCreate=m?[].concat(m,l):[l]}return r}function E(e){return function(e,t){return N(e,t)}}function N(e,t){var r=Oe?t.media||"default":e,n=Ne[r]||(Ne[r]={ids:new Set,styles:[]});if(!n.ids.has(e)){n.ids.add(e);var o=t.source;if(t.map&&(o+="\n/*# sourceURL="+t.map.sources[0]+" */",o+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t.map))))+" */"),n.element||(n.element=document.createElement("style"),n.element.type="text/css",t.media&&n.element.setAttribute("media",t.media),Ee.appendChild(n.element)),"styleSheet"in n.element)n.styles.push(o),n.element.styleSheet.cssText=n.styles.filter(Boolean).join("\n");else{var a=n.ids.size-1,i=document.createTextNode(o),s=n.element.childNodes;s[a]&&n.element.removeChild(s[a]),s.length?n.element.insertBefore(i,s[a]):n.element.appendChild(i)}}}e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a;var R=function(){return{consumers:[]}},A={setRoomState:function(e,t){"closed"===t.state&&(e.consumers=[])},addConsumer:function(e,t){e.consumers.push(t.consumer)},removeConsumer:function(e,t){var r=t.consumerId;e.consumers=e.consumers.filter(function(e){return e.id!==r})},setConsumerPaused:function(t,r){var n=r.consumerId,o=r.originator,a=t.consumers.find(function(e){return e.id===n});"local"===o?e.set(a,"locallyPaused",!0):e.set(a,"remotelyPaused",!0)},setConsumerResumed:function(t,r){var n=r.consumerId,o=r.originator,a=t.consumers.find(function(e){return e.id===n});"local"===o?e.set(a,"locallyPaused",!1):e.set(a,"remotelyPaused",!1)},setConsumerCurrentLayers:function(t,r){var n=r.consumerId,o=r.spatialLayer,a=r.temporalLayer,i=t.consumers.find(function(e){return e.id===n});e.set(i,"currentSpatialLayer",o),e.set(i,"currentTemporalLayer",a)},setConsumerPreferredLayers:function(t,r){var n=r.consumerId,o=r.spatialLayer,a=r.temporalLayer,i=t.consumers.find(function(e){return e.id===n});e.set(i,"preferredSpatialLayer",o),e.set(i,"preferredTemporalLayer",a)},setConsumerPriority:function(t,r){var n=r.consumerId,o=r.priority,a=t.consumers.find(function(e){return e.id===n});e.set(a,"priority",o)},setConsumerTrack:function(t,r){var n=r.consumerId,o=r.track,a=t.consumers.find(function(e){return e.id===n});e.set(a,"track",o)},setConsumerScore:function(t,r){var n=r.consumerId,o=r.score,a=t.consumers.find(function(e){return e.id===n});e.set(a,"score",o)}},F={namespaced:!0,state:R,mutations:A},L=function(){return{dataConsumers:[]}},B={setRoomState:function(e,t){"closed"===t.state&&(e.dataConsumers=[])},addDataConsumer:function(e,t){var r=t.dataConsumer;e.dataConsumers.push(r)},removeDataConsumer:function(e,t){var r=t.dataConsumerId;e.dataConsumers=e.dataConsumers.filter(function(e){return e.id!==r})}},V={namespaced:!0,state:L,mutations:B},W=function(){return{dataProducers:[]}},q={setRoomState:function(e,t){"closed"===t.state&&(e.dataProducers=[])},addDataProducer:function(e,t){var r=t.dataProducer;e.dataProducers.push(r)},removeDataProducer:function(e,t){var r=t.dataProducerId;e.dataProducers=e.dataProducers.filter(function(e){return e.id!==r})}},$={namespaced:!0,state:W,mutations:q},j={notify:function(e,t){var r=e.commit,n=t.type,o=void 0===n?"info":n,a=t.text,s=t.title,c=t.timeout;if(!c)switch(o){case"info":c=3e3;break;case"error":c=5e3}var u={id:i(6),type:o,title:s,text:a,timeout:c};r("notifications/addNotification",u),setTimeout(function(){r("notifications/removeNotification",{notificationId:u.id})},c)}},U={actions:j},G=function(){return{id:"",displayName:"",device:{flag:"",name:"",version:""},canSendMic:!0,canSendWebcam:!0,canChangeWebcam:!1,webcamInProgress:!1,shareInProgress:!1,audioOnly:!1,audioOnlyInProgress:!1,audioMuted:!1,restartIceInProgress:!1}},H={setRoomState:function(e,t){"closed"===t.state&&(e.webcamInProgress=!1,e.shareInProgress=!1,e.audioOnly=!1,e.audioOnlyInProgress=!1,e.audioMuted=!1,e.restartIceInProgress=!1)},setMe:function(e,t){var r=t.peerId,n=t.displayName,o=t.device;e.id=r,e.displayName=n,e.device=o},setMediaCapabilities:function(e,t){var r=t.canSendMic,n=t.canSendWebcam;e.canSendMic=r,e.canSendWebcam=n},setCanChangeWebcam:function(e,t){var r=t.canChangeWebcam;e.canChangeWebcam=r},setWebcamInProgress:function(e,t){var r=t.flag;e.webcamInProgress=r},setShareInProgress:function(e,t){var r=t.flag;e.shareInProgress=r},setDisplayName:function(e,t){var r=t.displayName;r&&(e.displayName=r)},setAudioOnlyState:function(e,t){var r=t.enabled;e.audioOnly=r},setAudioOnlyInProgress:function(e,t){var r=t.flag;e.audioOnlyInProgress=r},setAudioMutedState:function(e,t){var r=t.enabled;e.audioMuted=r},setRestartIceInProgress:function(e,t){var r=t.flag;e.restartIceInProgress=r}},K={namespaced:!0,state:G,mutations:H},Q=function(){return{notifications:[]}},Z={addNotification:function(e,t){e.notifications.push(t)},removeNotification:function(e,t){var r=t.notificationId;e.notifications=e.notifications.filter(function(e){return e.id!==r})},removeAllNotifications:function(e){e.notifications=[]}},Y={namespaced:!0,state:Q,mutations:Z},J=function(){return{peers:[]}},X={setRoomState:function(e,t){"closed"===t.state&&(e.peers=[])},addPeer:function(e,t){var r=t.peer;e.peers.push(r)},removePeer:function(e,t){var r=t.peerId;e.peers=e.peers.filter(function(e){return e.id!==r})},setPeerDisplayName:function(e,t){var r=t.displayName,n=t.peerId;if(!e.peers.find(function(e){return e.id===n}))throw new Error("no Peer found");e.peer.displayName=r},addConsumer:function(e,t){var r=t.consumer,n=t.peerId,o=e.peers.find(function(e){return e.id===n});if(!o)throw new Error("no Peer found for new Consumer");o.consumers.push(r.id)},removeConsumer:function(e,t){var r=t.consumerId,n=t.peerId,o=e.peers.find(function(e){return e.id===n});o&&(o.consumers=o.consumers.filter(function(e){return e===r}))},addDataConsumer:function(e,t){var r=t.dataConsumer,n=t.peerId;if(n){var o=e.peers.find(function(e){return e.id===n});if(!o)throw new Error("no Peer found for new DataConsumer");o.dataConsumers.push(r.id)}},removeDataConsumer:function(e,t){var r=t.dataConsumerId,n=t.peerId;if(n){var o=e.peers.find(function(e){return e.id===n});o&&(o.dataConsumers=o.dataConsumers.filter(function(e){return e===r}))}}},ee={namespaced:!0,state:J,mutations:X},te=function(){return{producers:[]}},re={setRoomState:function(e,t){"closed"===t.state&&(e.producers=[])},addProducer:function(e,t){var r=t.producer;e.producers.push(r)},removeProducer:function(e,t){var r=t.producerId;e.producers=e.producers.filter(function(e){return e.id!==r})},setProducerPaused:function(e,t){var r=t.producerId;e.producers.find(function(e){return e.id===r}).paused=!0},setProducerResumed:function(e,t){var r=t.producerId;e.producers.find(function(e){return e.id===r}).paused=!1},setProducerTrack:function(e,t){var r=t.producerId,n=t.track;e.producers.find(function(e){return e.id===r}).track=n},setProducerScore:function(e,t){var r=t.producerId,n=t.score;e.producers.find(function(e){return e.id===r}).score=n}},ne={namespaced:!0,state:te,mutations:re},oe=function(){return{url:"",state:"",activeSpeakerId:""}},ae={setRoomUrl:function(e,t){e.url=t.url},setRoomState:function(e,t){var r=t.state;"connected"!==r?(e.state=r,e.activeSpeakerId=null,e.statsPeerId=null):e.state=r},setRoomActiveSpeaker:function(e,t){var r=t.peerId;e.activeSpeakerId=r},setFaceDetection:function(e,t){var r=t.flag;e.faceDetection=r},removePeer:function(e,t){var r=t.peerId;r&&r===e.activeSpeakerId&&(e.activeSpeakerId=null),r&&r===e.statsPeerId&&(e.statsPeerId=null)}},ie={namespaced:!0,state:oe,mutations:ae},se="mediasoup-demo.user",ce="mediasoup-demo.devices",ue={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},de={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},le={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},pe={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},me={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"},he=function(){function e(){f(this,e)}return y(e,null,[{key:"getFirstMatch",value:function(e,t){var r=t.match(e);return r&&r.length>0&&r[1]||""}},{key:"getSecondMatch",value:function(e,t){var r=t.match(e);return r&&r.length>1&&r[2]||""}},{key:"matchAndReturnConst",value:function(e,t,r){if(e.test(t))return r}},{key:"getWindowsVersionName",value:function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}},{key:"getMacOSVersionName",value:function(e){var t=e.split(".").splice(0,2).map(function(e){return parseInt(e,10)||0});if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}},{key:"getAndroidVersionName",value:function(e){var t=e.split(".").splice(0,2).map(function(e){return parseInt(e,10)||0});if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0}},{key:"getVersionPrecision",value:function(e){return e.split(".").length}},{key:"compareVersions",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=e.getVersionPrecision(t),a=e.getVersionPrecision(r),i=Math.max(o,a),s=0,c=e.map([t,r],function(t){var r=i-e.getVersionPrecision(t),n=t+new Array(r+1).join(".0");return e.map(n.split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});for(n&&(s=i-Math.min(o,a)),i-=1;i>=s;){if(c[0][i]>c[1][i])return 1;if(c[0][i]===c[1][i]){if(i===s)return 0;i-=1}else if(c[0][i]<c[1][i])return-1}}},{key:"map",value:function(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)n.push(t(e[r]));return n}},{key:"find",value:function(e,t){var r,n;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,n=e.length;r<n;r+=1){var o=e[r];if(t(o,r))return o}}},{key:"assign",value:function(e){for(var t,r,n=e,o=arguments.length,a=new Array(o>1?o-1:0),i=1;i<o;i++)a[i-1]=arguments[i];if(Object.assign)return Object.assign.apply(Object,[e].concat(a));for(t=0,r=a.length;t<r;t+=1)!function(){var e=a[t];if("object"===p(e)&&null!==e){Object.keys(e).forEach(function(t){n[t]=e[t]})}}();return e}},{key:"getBrowserAlias",value:function(e){return ue[e]}},{key:"getBrowserTypeByAlias",value:function(e){return de[e]||""}}]),e}(),fe=/version\/(\d+(\.?_?\d+)+)/i,ve=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},r=he.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||he.getFirstMatch(fe,e);return r&&(t.version=r),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},r=he.getFirstMatch(fe,e)||he.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},r=he.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||he.getFirstMatch(fe,e);return r&&(t.version=r),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},r=he.getFirstMatch(fe,e)||he.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},r=he.getFirstMatch(fe,e)||he.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},r=he.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||he.getFirstMatch(fe,e);return r&&(t.version=r),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},r=he.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||he.getFirstMatch(fe,e);return r&&(t.version=r),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},r=he.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||he.getFirstMatch(fe,e);return r&&(t.version=r),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},r=he.getFirstMatch(fe,e)||he.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},r=he.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||he.getFirstMatch(fe,e);return r&&(t.version=r),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},r=he.getFirstMatch(fe,e)||he.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},r=he.getFirstMatch(fe,e)||he.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},r=he.getFirstMatch(fe,e)||he.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},r=he.getFirstMatch(fe,e)||he.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},r=he.getFirstMatch(fe,e)||he.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},r=he.getFirstMatch(fe,e)||he.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},r=he.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||he.getFirstMatch(fe,e);return r&&(t.version=r),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},r=he.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||he.getFirstMatch(fe,e);return r&&(t.version=r),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},r=he.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},r=he.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},r=he.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},r=he.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},r=he.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},r=he.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return r&&(t.version=r),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},r=he.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},r=he.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},r=he.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},r=he.getFirstMatch(fe,e)||he.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},r=he.getFirstMatch(fe,e)||he.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},r=he.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},r=he.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||he.getFirstMatch(fe,e);return r&&(t.version=r),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},r=he.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||he.getFirstMatch(fe,e);return r&&(t.version=r),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},r=he.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},r=he.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},r=he.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||he.getFirstMatch(fe,e);return r&&(t.version=r),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},r=he.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},r=he.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t={name:"Android Browser"},r=he.getFirstMatch(fe,e);return r&&(t.version=r),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},r=he.getFirstMatch(fe,e);return r&&(t.version=r),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},r=he.getFirstMatch(fe,e);return r&&(t.version=r),t}},{test:[/.*/i],describe:function(e){var t=/^(.*)\/(.*) /,r=/^(.*)\/(.*)[ \t]\((.*)/,n=-1!==e.search("\\("),o=n?r:t;return{name:he.getFirstMatch(o,e),version:he.getSecondMatch(o,e)}}}],ye=[{test:[/Roku\/DVP/],describe:function(e){var t=he.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:pe.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=he.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:pe.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=he.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),r=he.getWindowsVersionName(t);return{name:pe.Windows,version:t,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?) Version\//],describe:function(e){var t=he.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return{name:pe.iOS,version:t}}},{test:[/macintosh/i],describe:function(e){var t=he.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),r=he.getMacOSVersionName(t),n={name:pe.MacOS,version:t};return r&&(n.versionName=r),n}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=he.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:pe.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t=he.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),r=he.getAndroidVersionName(t),n={name:pe.Android,version:t};return r&&(n.versionName=r),n}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=he.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),r={name:pe.WebOS};return t&&t.length&&(r.version=t),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=he.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||he.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||he.getFirstMatch(/\bbb(\d+)/i,e);return{name:pe.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=he.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:pe.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=he.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:pe.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:pe.Linux}}},{test:[/CrOS/],describe:function(){return{name:pe.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=he.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:pe.PlayStation4,version:t}}}],be=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=he.getFirstMatch(/(can-l01)/i,e)&&"Nova",r={type:le.mobile,vendor:"Huawei"};return t&&(r.model=t),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:le.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:le.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?) Version\//],describe:function(){return{type:le.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:le.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:le.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:le.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),r=e.test(/like (ipod|iphone)/i);return t&&!r},describe:function(e){var t=he.getFirstMatch(/(ipod|iphone)/i,e);return{type:le.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:le.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:le.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:le.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:le.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:le.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:le.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:le.mobile}}},{test:function(e){
return"macos"===e.getOSName(!0)},describe:function(){return{type:le.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:le.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:le.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:le.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:le.tv}}}],ge=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:me.Blink};var t=he.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:me.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:me.Trident},r=he.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:me.Presto},r=he.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=e.test(/gecko/i),r=e.test(/like gecko/i);return t&&!r},describe:function(e){var t={name:me.Gecko},r=he.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:me.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:me.WebKit},r=he.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}],we=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(f(this,e),void 0===t||null===t||""===t)throw new Error("UserAgent parameter can't be empty");this._ua=t,this.parsedResult={},!0!==r&&this.parse()}return y(e,[{key:"getUA",value:function(){return this._ua}},{key:"test",value:function(e){return e.test(this._ua)}},{key:"parseBrowser",value:function(){var e=this;this.parsedResult.browser={};var t=he.find(ve,function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser}},{key:"getBrowser",value:function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}},{key:"getBrowserName",value:function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}},{key:"getBrowserVersion",value:function(){return this.getBrowser().version}},{key:"getOS",value:function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}},{key:"parseOS",value:function(){var e=this;this.parsedResult.os={};var t=he.find(ye,function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os}},{key:"getOSName",value:function(e){var t=this.getOS(),r=t.name;return e?String(r).toLowerCase()||"":r||""}},{key:"getOSVersion",value:function(){return this.getOS().version}},{key:"getPlatform",value:function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}},{key:"getPlatformType",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getPlatform(),r=t.type;return e?String(r).toLowerCase()||"":r||""}},{key:"parsePlatform",value:function(){var e=this;this.parsedResult.platform={};var t=he.find(be,function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform}},{key:"getEngine",value:function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}},{key:"getEngineName",value:function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}},{key:"parseEngine",value:function(){var e=this;this.parsedResult.engine={};var t=he.find(ge,function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine}},{key:"parse",value:function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}},{key:"getResult",value:function(){return he.assign({},this.parsedResult)}},{key:"satisfies",value:function(e){var t=this,r={},n=0,o={},a=0;if(Object.keys(e).forEach(function(t){var i=e[t];"string"==typeof i?(o[t]=i,a+=1):"object"===p(i)&&(r[t]=i,n+=1)}),n>0){var i=Object.keys(r),s=he.find(i,function(e){return t.isOS(e)});if(s){var c=this.satisfies(r[s]);if(void 0!==c)return c}var u=he.find(i,function(e){return t.isPlatform(e)});if(u){var d=this.satisfies(r[u]);if(void 0!==d)return d}}if(a>0){var l=Object.keys(o),m=he.find(l,function(e){return t.isBrowser(e,!0)});if(void 0!==m)return this.compareVersion(o[m])}}},{key:"isBrowser",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.getBrowserName().toLowerCase(),n=e.toLowerCase(),o=he.getBrowserTypeByAlias(n);return t&&o&&(n=o.toLowerCase()),n===r}},{key:"compareVersion",value:function(e){var t=[0],r=e,n=!1,o=this.getBrowserVersion();if("string"==typeof o)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(n=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(n=!0,r=e.substr(1)),t.indexOf(he.compareVersions(o,r,n))>-1}},{key:"isOS",value:function(e){return this.getOSName(!0)===String(e).toLowerCase()}},{key:"isPlatform",value:function(e){return this.getPlatformType(!0)===String(e).toLowerCase()}},{key:"isEngine",value:function(e){return this.getEngineName(!0)===String(e).toLowerCase()}},{key:"is",value:function(e){return this.isBrowser(e)||this.isOS(e)||this.isPlatform(e)}},{key:"some",value:function(){var e=this;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).some(function(t){return e.is(t)})}}]),e}(),Ce=function(){function e(){f(this,e)}return y(e,null,[{key:"getParser",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("string"!=typeof e)throw new Error("UserAgent should be a string");return new we(e,t)}},{key:"parse",value:function(e){return new we(e).getResult()}},{key:"BROWSER_MAP",get:function(){return de}},{key:"ENGINE_MAP",get:function(){return me}},{key:"OS_MAP",get:function(){return pe}},{key:"PLATFORMS_MAP",get:function(){return le}}]),e}();window.BOWSER=Ce;var _e=function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e){var t=function(e){function t(e,t,r,o){var a=t&&t.prototype instanceof n?t:n,i=Object.create(a.prototype),s=new m(o||[]);return i._invoke=c(e,r,s),i}function r(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function n(){}function o(){}function a(){}function i(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function s(e,t){function n(o,a,i,s){var c=r(e[o],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"===p(d)&&b.call(d,"__await")?t.resolve(d.__await).then(function(e){n("next",e,i,s)},function(e){n("throw",e,i,s)}):t.resolve(d).then(function(e){u.value=e,i(u)},function(e){return n("throw",e,i,s)})}s(c.arg)}function o(e,r){function o(){return new t(function(t,o){n(e,r,t,o)})}return a=a?a.then(o,o):o()}var a;this._invoke=o}function c(e,t,n){var o=k;return function(a,i){if(o===x)throw new Error("Generator is already running");if(o===S){if("throw"===a)throw i;return f()}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var c=u(s,n);if(c){if(c===z)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===k)throw o=S,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=x;var d=r(e,t,n);if("normal"===d.type){if(o=n.done?S:P,d.arg===z)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=S,n.method="throw",n.arg=d.arg)}}}function u(e,t){var n=e.iterator[t.method];if(n===v){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=v,u(e,t),"throw"===t.method))return z;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return z}var o=r(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,z;var a=o.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=v),t.delegate=null,z):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,z)}function d(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function l(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function m(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(d,this),this.reset(!0)}function h(e){if(e){var t=e[w];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(b.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=v,t.done=!0,t};return n.next=n}}return{next:f}}function f(){return{value:v,done:!0}}var v,y=Object.prototype,b=y.hasOwnProperty,g="function"==typeof Symbol?Symbol:{},w=g.iterator||"@@iterator",C=g.asyncIterator||"@@asyncIterator",_=g.toStringTag||"@@toStringTag";e.wrap=t;var k="suspendedStart",P="suspendedYield",x="executing",S="completed",z={},M={};M[w]=function(){return this};var I=Object.getPrototypeOf,D=I&&I(I(h([])));D&&D!==y&&b.call(D,w)&&(M=D);var T=a.prototype=n.prototype=Object.create(M);return o.prototype=T.constructor=a,a.constructor=o,a[_]=o.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,_ in e||(e[_]="GeneratorFunction")),e.prototype=Object.create(T),e},e.awrap=function(e){return{__await:e}},i(s.prototype),s.prototype[C]=function(){return this},e.AsyncIterator=s,e.async=function(r,n,o,a,i){void 0===i&&(i=Promise);var c=new s(t(r,n,o,a),i);return e.isGeneratorFunction(n)?c:c.next().then(function(e){return e.done?e.value:c.next()})},i(T),T[_]="Generator",T[w]=function(){return this},T.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=h,m.prototype={constructor:m,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=v,this.done=!1,this.delegate=null,this.method="next",this.arg=v,this.tryEntries.forEach(l),!e)for(var t in this)"t"===t.charAt(0)&&b.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=v)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,n){return a.type="throw",a.arg=e,r.next=t,n&&(r.method="next",r.arg=v),!!n}if(this.done)throw e;for(var r=this,n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],a=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var i=b.call(o,"catchLoc"),s=b.call(o,"finallyLoc");if(i&&s){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(i){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&b.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,z):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),z},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),l(r),z}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;l(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:h(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=v),z}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}),ke=_e,Pe={qvga:{width:{ideal:320},height:{ideal:240}},vga:{width:{ideal:640},height:{ideal:480}},hd:{width:{ideal:1280},height:{ideal:720}}},xe={optional:[{googDscp:!0}]},Se=[{scaleResolutionDownBy:4},{scaleResolutionDownBy:2},{scaleResolutionDownBy:1}],ze=[{scalabilityMode:"S3T3_KEY"}],Me=[{scalabilityMode:"S3T3",dtx:!0}],Ie=function(){function e(t){var r=t.store;f(this,e),this.store=r,this._closed=!1,this._produce=!0,this._consume=!0,this._useDataChannel=!0,this._externalVideo=null,this._externalVideoStream=null,this._nextDataChannelTestNumber=0,this._protooUrl=null,this._protoo=null,this._mediasoupDevice=null,this._sendTransport=null,this._recvTransport=null,this._micProducer=null,this._webcamProducer=null,this._shareProducer=null,this._chatDataProducer=null,this._botDataProducer=null,this._consumers=new Map,this._dataConsumers=new Map,this._webcams=new Map,this._webcam={device:null,resolution:"hd"}}return y(e,[{key:"close",value:function(){this._closed||(this._closed=!0,console.debug("close()"),this._protoo.close(),this._sendTransport&&this._sendTransport.close(),this._recvTransport&&this._recvTransport.close(),this.store.commit("zeyeClient/room/setRoomState",{state:"closed"}))}},{key:"join",value:function(e){var t=this,r=e.roomId,a=e.peerId,i=e.displayName,s=e.forceH264,c=e.forceVP9,u=e.hostname,d=e.protooPort;s=void 0!==s&&s,c=void 0!==c&&c,u=void 0!==u&&u,d=void 0!==d&&d,this._displayName=void 0!==i?i:l(),this._protooUrl=T({roomId:r,peerId:a,forceH264:s,forceVP9:c,hostname:u,protooPort:d});var p=new n.WebSocketTransport(this._protooUrl);this._protoo=new n.Peer(p),this.store.commit("zeyeClient/room/setRoomState",{state:"connecting"}),this._protoo.on("open",function(){return t._joinRoom()}),this._protoo.on("failed",function(){t.store.dispatch("zeyeClient/notify",{type:"error",text:"WebSocket connection failed"})}),this._protoo.on("disconnected",function(){t.store.dispatch("zeyeClient/notify",{type:"error",text:"WebSocket disconnected"}),t._sendTransport&&(t._sendTransport.close(),t._sendTransport=null),t._recvTransport&&(t._recvTransport.close(),t._recvTransport=null),t.store.commit("zeyeClient/room/setRoomState",{state:"closed"})}),this._protoo.on("close",function(){t._closed||t.close()}),this._protoo.on("request",function(){var e=h(ke.mark(function e(r,n,a){var i,s,c,u,d,l,p,m,h,f,v,y,b,g,C,_,k,P,x,S,z,M;return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.debug('proto "request" event [method:%s, data:%o]',r.method,r.data),e.t0=r.method,e.next="newConsumer"===e.t0?4:"newDataConsumer"===e.t0?27:56;break;case 4:if(t._consume){e.next=7;break}return a(403,"I do not want to consume"),e.abrupt("break",56);case 7:return i=r.data,s=i.peerId,c=i.producerId,u=i.id,d=i.kind,l=i.rtpParameters,p=i.type,m=i.appData,h=i.producerPaused,e.prev=8,e.next=11,t._recvTransport.consume({id:u,producerId:c,kind:d,rtpParameters:l,appData:w({},m,{peerId:s})});case 11:f=e.sent,t._consumers.set(f.id,f),f.on("transportclose",function(){t._consumers.delete(f.id)}),v=o.parseScalabilityMode(f.rtpParameters.encodings[0].scalabilityMode),y=v.spatialLayers,b=v.temporalLayers,t.store.commit("zeyeClient/peers/addConsumer",{consumer:{id:f.id},peerId:s}),t.store.commit("zeyeClient/consumers/addConsumer",{consumer:{id:f.id,type:p,locallyPaused:!1,remotelyPaused:h,rtpParameters:f.rtpParameters,spatialLayers:y,temporalLayers:b,preferredSpatialLayer:y-1,preferredTemporalLayer:b-1,priority:1,codec:f.rtpParameters.codecs[0].mimeType.split("/")[1],track:f.track}}),n(),"video"===f.kind&&t.store.state.zeyeClient.me.audioOnly&&t._pauseConsumer(f),e.next=26;break;case 21:throw e.prev=21,e.t1=e.catch(8),console.error('"newConsumer" request failed:%o',e.t1),t.store.dispatch("zeyeClient/notify",{type:"error",text:"Error creating a Consumer: ".concat(e.t1)}),e.t1;case 26:return e.abrupt("break",56);case 27:if(t._consume){e.next=30;break}return a(403,"I do not want to data consume"),e.abrupt("break",56);case 30:if(t._useDataChannel){e.next=33;break}return a(403,"I do not want DataChannels"),e.abrupt("break",56);case 33:return g=r.data,C=g.peerId,_=g.dataProducerId,k=g.id,P=g.sctpStreamParameters,x=g.label,S=g.protocol,z=g.appData,e.prev=34,e.next=37,t._recvTransport.consumeData({id:k,dataProducerId:_,sctpStreamParameters:P,label:x,protocol:S,appData:w({},z,{peerId:C})});case 37:M=e.sent,t._dataConsumers.set(M.id,M),M.on("transportclose",function(){t._dataConsumers.delete(M.id)}),M.on("open",function(){console.debug('DataConsumer "open" event')}),M.on("close",function(){console.warn('DataConsumer "close" event'),t._dataConsumers.delete(M.id),t.store.dispatch("zeyeClient/notify",{type:"error",text:"DataConsumer closed"})}),M.on("error",function(e){console.error('DataConsumer "error" event:%o',e),t.store.dispatch("zeyeClient/notify",{type:"error",text:"DataConsumer error: ".concat(e)})}),M.on("message",function(e){if(console.debug('DataConsumer "message" event [streamId:%d]',M.sctpStreamParameters.streamId),window.DC_MESSAGE=e,e instanceof ArrayBuffer){var r=new DataView(e),n=r.getUint32();return n===Math.pow(2,32)-1?(console.warn("dataChannelTest finished!"),void(t._nextDataChannelTestNumber=0)):(n>t._nextDataChannelTestNumber&&console.warn("dataChannelTest: %s packets missing",n-t._nextDataChannelTestNumber),void(t._nextDataChannelTestNumber=n+1))}if("string"!=typeof e)return void console.warn('ignoring DataConsumer "message" (not a string)');switch(M.label){case"chat":var o=t.store.state.peers,a=Object.keys(o).map(function(e){return o[e]}),i=a.find(function(e){return e.dataConsumers.includes(M.id)});if(!i){console.warn('DataConsumer "message" from unknown peer');break}t.store.dispatch("zeyeClient/notify",{title:"".concat(i.displayName," says:"),text:e,timeout:5e3});break;case"bot":t.store.dispatch("zeyeClient/notify",{title:"Message from Bot:",text:e,timeout:5e3})}}),window.DC=M,t.store.commit("zeyeClient/peers/addDataConsumer",{dataConsumer:{id:M.id}}),t.store.commit("zeyeClient/dataConsumers/addDataConsumer",{dataConsumer:{id:M.id,sctpStreamParameters:M.sctpStreamParameters,label:M.label,protocol:M.protocol}}),n(),e.next=55;break;case 50:throw e.prev=50,e.t2=e.catch(34),console.error('"newDataConsumer" request failed:%o',e.t2),t.store.dispatch("zeyeClient/notify",{type:"error",text:"Error creating a DataConsumer: ".concat(e.t2)}),e.t2;case 55:return e.abrupt("break",56);case 56:case"end":return e.stop()}},e,null,[[8,21],[34,50]])}));return function(t,r,n){return e.apply(this,arguments)}}()),this._protoo.on("notification",function(e){switch(console.debug('proto "notification" event [method:%s, data:%o]',e.method,e.data),e.method){case"producerScore":var r=e.data,n=r.producerId,o=r.score;t.store.commit("zeyeClient/producers/setProducerScore",{producerId:n,score:o});break;case"newPeer":var a=e.data;t.store.commit("zeyeClient/peers/addPeer",{peer:w({},a,{consumers:[],dataConsumers:[]})}),t.store.dispatch("zeyeClient/notify",{text:"".concat(a.displayName," has joined the room")});break;case"peerClosed":var i=e.data.peerId;t.store.commit("zeyeClient/peers/removePeer",{peerId:i});break;case"peerDisplayNameChanged":var s=e.data,c=s.peerId,u=s.displayName,d=s.oldDisplayName;t.store.commit("zeyeClient/peers/setPeerDisplayName",{displayName:u,peerId:c}),t.store.dispatch("zeyeClient/notify",{text:"".concat(d," is now ").concat(u)});break;case"consumerClosed":var l=e.data.consumerId,p=t._consumers.get(l);if(!p)break;p.close(),t._consumers.delete(l);var m=p.appData.peerId;t.store.commit("zeyeClient/peers/removeConsumer",{consumerId:l,peerId:m}),t.store.commit("zeyeClient/consumers/removeConsumer",{consumerId:l,peerId:m});break;case"consumerPaused":var h=e.data.consumerId;if(!t._consumers.get(h))break;t.store.commit("zeyeClient/consumers/setConsumerPaused",{consumerId:h,originator:"remote"});break;case"consumerResumed":var f=e.data.consumerId;if(!t._consumers.get(f))break;t.store.commit("zeyeClient/consumers/setConsumerResumed",{consumerId:f,originator:"remote"});break;case"consumerLayersChanged":var v=e.data,y=v.consumerId,b=v.spatialLayer,g=v.temporalLayer;if(!t._consumers.get(y))break;t.store.commit("zeyeClient/consumers/setConsumerCurrentLayers",{consumerId:y,spatialLayer:b,temporalLayer:g});break;case"consumerScore":var C=e.data,_=C.consumerId,k=C.score;t.store.commit("zeyeClient/consumers/setConsumerScore",{consumerId:_,score:k});break;case"dataConsumerClosed":var P=e.data.dataConsumerId,x=t._dataConsumers.get(P);if(!x)break;x.close(),t._dataConsumers.delete(P);var S=x.appData.peerId;t.store.commit("zeyeClient/dataConsumers/removeDataConsumer",{dataConsumerId:P,peerId:S});break;case"activeSpeaker":var z=e.data.peerId;t.store.commit("zeyeClient/room/setRoomActiveSpeaker",{peerId:z});break;default:console.error('unknown protoo notification.method "%s"',e.method)}}),this.ready=!0}},{key:"enableMic",value:function(){function e(){return t.apply(this,arguments)}var t=h(ke.mark(function e(){var t,r,n,o=this;return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.debug("enableMic()"),!this._micProducer){e.next=3;break}return e.abrupt("return");case 3:if(this._mediasoupDevice.canProduce("audio")){e.next=6;break}return console.error("enableMic() | cannot produce audio"),e.abrupt("return");case 6:if(e.prev=6,this._externalVideo){e.next=15;break}return console.debug("enableMic() | calling getUserMedia()"),e.next=11,navigator.mediaDevices.getUserMedia({audio:!0});case 11:r=e.sent,t=r.getAudioTracks()[0],e.next=19;break;case 15:return e.next=17,this._getExternalVideoStream();case 17:n=e.sent,t=n.getAudioTracks()[0].clone();case 19:return e.next=21,this._sendTransport.produce({track:t,codecOptions:{opusStereo:1,opusDtx:1}});case 21:this._micProducer=e.sent,this.store.commit("zeyeClient/producers/addProducer",{producer:{id:this._micProducer.id,paused:this._micProducer.paused,track:this._micProducer.track,rtpParameters:this._micProducer.rtpParameters,codec:this._micProducer.rtpParameters.codecs[0].mimeType.split("/")[1]}}),this._micProducer.on("transportclose",function(){o._micProducer=null}),this._micProducer.on("trackended",function(){o.store.dispatch("zeyeClient/notify",{type:"error",text:"Microphone disconnected!"}),o.disableMic().catch(function(){})}),e.next=32;break;case 27:e.prev=27,e.t0=e.catch(6),console.error("enableMic() | failed:%o",e.t0),this.store.dispatch("zeyeClient/notify",{type:"error",text:"Error enabling microphone: ".concat(e.t0)}),t&&t.stop();case 32:case"end":return e.stop()}},e,this,[[6,27]])}));return e}()},{key:"disableMic",value:function(){function e(){return t.apply(this,arguments)}var t=h(ke.mark(function e(){return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.debug("disableMic()"),this._micProducer){e.next=3;break}return e.abrupt("return");case 3:return this._micProducer.close(),this.store.commit("zeyeClient/producers/removeProducer",{producerId:this._micProducer.id}),e.prev=5,e.next=8,this._protoo.request("closeProducer",{producerId:this._micProducer.id});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),this.store.dispatch("zeyeClient/notify",{type:"error",text:"Error closing server-side mic Producer: ".concat(e.t0)});case 13:this._micProducer=null;case 14:case"end":return e.stop()}},e,this,[[5,10]])}));return e}()},{key:"muteMic",value:function(){function e(){return t.apply(this,arguments)}var t=h(ke.mark(function e(){return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("muteMic()"),this._micProducer.pause(),e.prev=2,e.next=5,this._protoo.request("pauseProducer",{producerId:this._micProducer.id});case 5:this.store.commit("zeyeClient/producers/setProducerPaused",{producerId:this._micProducer.id}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(2),console.error("muteMic() | failed: %o",e.t0),this.store.dispatch("zeyeClient/notify",{type:"error",text:"Error pausing server-side mic Producer: ".concat(e.t0)});case 12:case"end":return e.stop()}},e,this,[[2,8]])}));return e}()},{key:"unmuteMic",value:function(){function e(){return t.apply(this,arguments)}var t=h(ke.mark(function e(){return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("unmuteMic()"),this._micProducer.resume(),e.prev=2,e.next=5,this._protoo.request("resumeProducer",{producerId:this._micProducer.id});case 5:this.store.commit("zeyeClient/producers/setProducerResumed",{producerId:this._micProducer.id}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(2),console.error("unmuteMic() | failed: %o",e.t0),this.store.dispatch("zeyeClient/notify",{type:"error",text:"Error resuming server-side mic Producer: ".concat(e.t0)});case 12:case"end":return e.stop()}},e,this,[[2,8]])}));return e}()},{key:"enableWebcam",value:function(){function e(){return t.apply(this,arguments)}var t=h(ke.mark(function e(){var t,r,n,o,a,i,s,c=this;return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.debug("enableWebcam()"),!this._webcamProducer){e.next=5;break}return e.abrupt("return");case 5:if(!this._shareProducer){e.next=8;break}return e.next=8,this.disableShare();case 8:if(this._mediasoupDevice.canProduce("video")){e.next=11;break}return console.error("enableWebcam() | cannot produce video"),e.abrupt("return");case 11:if(this.store.commit("zeyeClient/me/setWebcamInProgress",{flag:!0}),e.prev=12,this._externalVideo){e.next=27;break}return e.next=16,this._updateWebcams();case 16:if(r=this._webcam.device,n=this._webcam.resolution,r){e.next=20;break}throw new Error("no webcam devices");case 20:return console.debug("enableWebcam() | calling getUserMedia()"),e.next=23,navigator.mediaDevices.getUserMedia({video:w({deviceId:{ideal:r.deviceId}},Pe[n])});case 23:o=e.sent,t=o.getVideoTracks()[0],e.next=32;break;case 27:return r={label:"external video"},e.next=30,this._getExternalVideoStream();case 30:a=e.sent,t=a.getVideoTracks()[0].clone();case 32:if(!this._useSimulcast){e.next=40;break}return i=this._mediasoupDevice.rtpCapabilities.codecs.find(function(e){return"video"===e.kind}),s="video/vp9"===i.mimeType.toLowerCase()?ze:Se,e.next=37,this._sendTransport.produce({track:t,encodings:s,codecOptions:{videoGoogleStartBitrate:1e3}});case 37:this._webcamProducer=e.sent,e.next=43;break;case 40:return e.next=42,this._sendTransport.produce({track:t});case 42:this._webcamProducer=e.sent;case 43:this.store.commit("zeyeClient/producers/addProducer",{producer:{id:this._webcamProducer.id,deviceLabel:r.label,type:this._getWebcamType(r),paused:this._webcamProducer.paused,track:this._webcamProducer.track,rtpParameters:this._webcamProducer.rtpParameters,codec:this._webcamProducer.rtpParameters.codecs[0].mimeType.split("/")[1]}}),this._webcamProducer.on("transportclose",function(){c._webcamProducer=null}),this._webcamProducer.on("trackended",function(){c.store.dispatch("zeyeClient/notify",{type:"error",text:"Webcam disconnected!"}),c.disableWebcam().catch(function(){})}),e.next=53;break;case 48:e.prev=48,e.t0=e.catch(12),console.error("enableWebcam() | failed:%o",e.t0),this.store.dispatch("zeyeClient/notify",{type:"error",text:"Error enabling webcam: ".concat(e.t0)}),t&&t.stop();case 53:this.store.commit("zeyeClient/me/setWebcamInProgress",{flag:!1});case 54:case"end":return e.stop()}},e,this,[[12,48]])}));return e}()},{key:"disableWebcam",value:function(){function e(){return t.apply(this,arguments)}var t=h(ke.mark(function e(){return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.debug("disableWebcam()"),this._webcamProducer){e.next=3;break}return e.abrupt("return");case 3:return this._webcamProducer.close(),this.store.commit("zeyeClient/producers/removeProducer",{producerId:this._webcamProducer.id}),e.prev=5,e.next=8,this._protoo.request("closeProducer",{producerId:this._webcamProducer.id});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),this.store.dispatch("zeyeClient/notify",{type:"error",text:"Error closing server-side webcam Producer: ".concat(e.t0)});case 13:this._webcamProducer=null;case 14:case"end":return e.stop()}},e,this,[[5,10]])}));return e}()},{key:"changeWebcam",value:function(){function e(){return t.apply(this,arguments)}var t=h(ke.mark(function e(){var t,r,n,o,a,i;return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("changeWebcam()"),this.store.commit("zeyeClient/me/setWebcamInProgress",{flag:!0}),e.prev=2,e.next=5,this._updateWebcams();case 5:if(t=Array.from(this._webcams.keys()),r=t.length,n=this._webcam.device?this._webcam.device.deviceId:void 0,o=t.indexOf(n),o<r-1?o++:o=0,this._webcam.device=this._webcams.get(t[o]),console.debug("changeWebcam() | new selected webcam [device:%o]",this._webcam.device),this._webcam.resolution="hd",this._webcam.device){e.next=15;break}throw new Error("no webcam devices");case 15:return this._webcamProducer.track.stop(),console.debug("changeWebcam() | calling getUserMedia()"),e.next=19,navigator.mediaDevices.getUserMedia({video:w({deviceId:{exact:this._webcam.device.deviceId}},Pe[this._webcam.resolution])});case 19:return a=e.sent,i=a.getVideoTracks()[0],e.next=23,this._webcamProducer.replaceTrack({track:i});case 23:this.store.commit("zeyeClient/producers/setProducerTrack",{producerId:this._webcamProducer.id,track:i}),e.next=30;break;case 26:e.prev=26,e.t0=e.catch(2),console.error("changeWebcam() | failed: %o",e.t0),this.store.dispatch("zeyeClient/notify",{type:"error",text:"Could not change webcam: ".concat(e.t0)});case 30:this.store.commit("zeyeClient/me/setWebcamInProgress",{flag:!1});case 31:case"end":return e.stop()}},e,this,[[2,26]])}));return e}()},{key:"changeWebcamResolution",value:function(){function e(){return t.apply(this,arguments)}var t=h(ke.mark(function e(){var t,r;return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.debug("changeWebcamResolution()"),this.store.commit("zeyeClient/me/setWebcamInProgress",{flag:!0}),e.prev=2,e.t0=this._webcam.resolution,e.next="qvga"===e.t0?6:"vga"===e.t0?8:"hd"===e.t0?10:12;break;case 6:return this._webcam.resolution="vga",e.abrupt("break",13);case 8:return this._webcam.resolution="hd",e.abrupt("break",13);case 10:return this._webcam.resolution="qvga",e.abrupt("break",13);case 12:this._webcam.resolution="hd";case 13:return console.debug("changeWebcamResolution() | calling getUserMedia()"),e.next=16,navigator.mediaDevices.getUserMedia({video:w({deviceId:{exact:this._webcam.device.deviceId}},Pe[this._webcam.resolution])});case 16:return t=e.sent,r=t.getVideoTracks()[0],e.next=20,this._webcamProducer.replaceTrack({track:r});case 20:this.store.commit("zeyeClient/producers/setProducerTrack",{producerId:this._webcamProducer.id,track:r}),e.next=27;break;case 23:e.prev=23,e.t1=e.catch(2),console.error("changeWebcamResolution() | failed: %o",e.t1),this.store.dispatch("zeyeClient/notify",{type:"error",text:"Could not change webcam resolution: ".concat(e.t1)});case 27:this.store.commit("zeyeClient/me/setWebcamInProgress",{flag:!1});case 28:case"end":return e.stop()}},e,this,[[2,23]])}));return e}()},{key:"enableShare",value:function(){function e(){
return t.apply(this,arguments)}var t=h(ke.mark(function e(){var t,r,n,o,a=this;return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.debug("enableShare()"),!this._shareProducer){e.next=5;break}return e.abrupt("return");case 5:if(!this._webcamProducer){e.next=8;break}return e.next=8,this.disableWebcam();case 8:if(this._mediasoupDevice.canProduce("video")){e.next=11;break}return console.error("enableShare() | cannot produce video"),e.abrupt("return");case 11:return this.store.commit("zeyeClient/me/setShareInProgress",{flag:!0}),e.prev=12,console.debug("enableShare() | calling getUserMedia()"),e.next=16,navigator.mediaDevices.getDisplayMedia({audio:!1,video:{displaySurface:"monitor",logicalSurface:!0,cursor:!0,width:{max:1920},height:{max:1080},frameRate:{max:30}}});case 16:if(r=e.sent){e.next=20;break}return this.store.commit("zeyeClient/me/setShareInProgress",{flag:!0}),e.abrupt("return");case 20:if(t=r.getVideoTracks()[0],!this._useSharingSimulcast){e.next=29;break}return n=this._mediasoupDevice.rtpCapabilities.codecs.find(function(e){return"video"===e.kind}),o="video/vp9"===n.mimeType.toLowerCase()?Me:Se.map(function(e){return w({},e,{dtx:!0})}),e.next=26,this._sendTransport.produce({track:t,encodings:o,codecOptions:{videoGoogleStartBitrate:1e3},appData:{share:!0}});case 26:this._shareProducer=e.sent,e.next=32;break;case 29:return e.next=31,this._sendTransport.produce({track:t});case 31:this._shareProducer=e.sent;case 32:this.store.commit("zeyeClient/producers/addProducer",{producer:{id:this._shareProducer.id,type:"share",paused:this._shareProducer.paused,track:this._shareProducer.track,rtpParameters:this._shareProducer.rtpParameters,codec:this._shareProducer.rtpParameters.codecs[0].mimeType.split("/")[1]}}),this._shareProducer.on("transportclose",function(){a._shareProducer=null}),this._shareProducer.on("trackended",function(){a.store.dispatch("zeyeClient/notify",{type:"error",text:"Share disconnected!"}),a.disableShare().catch(function(){})}),e.next=42;break;case 37:e.prev=37,e.t0=e.catch(12),console.error("enableShare() | failed:%o",e.t0),"NotAllowedError"!==e.t0.name&&this.store.dispatch("zeyeClient/notify",{type:"error",text:"Error sharing: ".concat(e.t0)}),t&&t.stop();case 42:this.store.commit("zeyeClient/me/setShareInProgress",{flag:!1});case 43:case"end":return e.stop()}},e,this,[[12,37]])}));return e}()},{key:"disableShare",value:function(){function e(){return t.apply(this,arguments)}var t=h(ke.mark(function e(){return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.debug("disableShare()"),this._shareProducer){e.next=3;break}return e.abrupt("return");case 3:return this._shareProducer.close(),this.store.commit("zeyeClient/producers/removeProducer",{producerId:this._shareProducer.id}),e.prev=5,e.next=8,this._protoo.request("closeProducer",{producerId:this._shareProducer.id});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),this.store.dispatch("zeyeClient/notify",{type:"error",text:"Error closing server-side share Producer: ".concat(e.t0)});case 13:this._shareProducer=null;case 14:case"end":return e.stop()}},e,this,[[5,10]])}));return e}()},{key:"enableAudioOnly",value:function(){console.debug("enableAudioOnly()"),this.store.commit("zeyeClient/me/setAudioOnlyInProgress",{flag:!0}),this.disableWebcam();var e,t=k(this._consumers.values());try{for(t.s();!(e=t.n()).done;){var r=e.value;"video"===r.kind&&this._pauseConsumer(r)}}catch(e){t.e(e)}finally{t.f()}this.store.commit("zeyeClient/me/setAudioOnlyState",{enabled:!0}),this.store.commit("zeyeClient/me/setAudioOnlyInProgress",{flag:!1})}},{key:"disableAudioOnly",value:function(){console.debug("disableAudioOnly()"),this.store.commit("zeyeClient/me/setAudioOnlyInProgress",{flag:!0}),!this._webcamProducer&&this._produce&&(u()||{}).webcamEnabled&&this.enableWebcam();var e,t=k(this._consumers.values());try{for(t.s();!(e=t.n()).done;){var r=e.value;"video"===r.kind&&this._resumeConsumer(r)}}catch(e){t.e(e)}finally{t.f()}this.store.commit("zeyeClient/me/setAudioOnlyState",{enabled:!1}),this.store.commit("zeyeClient/me/setAudioOnlyInProgress",{flag:!1})}},{key:"muteAudio",value:function(){console.debug("muteAudio()"),this.store.commit("zeyeClient/me/setAudioMutedState",{flag:!0})}},{key:"unmuteAudio",value:function(){console.debug("unmuteAudio()"),this.store.commit("zeyeClient/me/setAudioMutedState",{flag:!1})}},{key:"restartIce",value:function(){function e(){return t.apply(this,arguments)}var t=h(ke.mark(function e(){var t,r;return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.debug("restartIce()"),this.store.commit("zeyeClient/me/setRestartIceInProgress",{flag:!0}),e.prev=2,!this._sendTransport){e.next=9;break}return e.next=6,this._protoo.request("restartIce",{transportId:this._sendTransport.id});case 6:return t=e.sent,e.next=9,this._sendTransport.restartIce({iceParameters:t});case 9:if(!this._recvTransport){e.next=15;break}return e.next=12,this._protoo.request("restartIce",{transportId:this._recvTransport.id});case 12:return r=e.sent,e.next=15,this._recvTransport.restartIce({iceParameters:r});case 15:this.store.dispatch("zeyeClient/notify",{text:"ICE restarted"}),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(2),console.error("restartIce() | failed:%o",e.t0),this.store.dispatch("zeyeClient/notify",{type:"error",text:"ICE restart failed: ".concat(e.t0)});case 22:this.store.commit("zeyeClient/me/setRestartIceInProgress",{flag:!1});case 23:case"end":return e.stop()}},e,this,[[2,18]])}));return e}()},{key:"setMaxSendingSpatialLayer",value:function(){function e(e){return t.apply(this,arguments)}var t=h(ke.mark(function e(t){return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.debug("setMaxSendingSpatialLayer() [spatialLayer:%s]",t),e.prev=1,!this._webcamProducer){e.next=7;break}return e.next=5,this._webcamProducer.setMaxSpatialLayer(t);case 5:e.next=10;break;case 7:if(!this._shareProducer){e.next=10;break}return e.next=10,this._shareProducer.setMaxSpatialLayer(t);case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(1),console.error("setMaxSendingSpatialLayer() | failed:%o",e.t0),this.store.dispatch("zeyeClient/notify",{type:"error",text:"Error setting max sending video spatial layer: ".concat(e.t0)});case 16:case"end":return e.stop()}},e,this,[[1,12]])}));return e}()},{key:"setConsumerPreferredLayers",value:function(){function e(e,r,n){return t.apply(this,arguments)}var t=h(ke.mark(function e(t,r,n){return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("setConsumerPreferredLayers() [consumerId:%s, spatialLayer:%s, temporalLayer:%s]",t,r,n),e.prev=1,e.next=4,this._protoo.request("setConsumerPreferredLayers",{consumerId:t,spatialLayer:r,temporalLayer:n});case 4:this.store.commit("zeyeClient/consumers/setConsumerPreferredLayers",{consumerId:t,spatialLayer:r,temporalLayer:n}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),console.error("setConsumerPreferredLayers() | failed:%o",e.t0),this.store.dispatch("zeyeClient/notify",{type:"error",text:"Error setting Consumer preferred layers: ".concat(e.t0)});case 11:case"end":return e.stop()}},e,this,[[1,7]])}));return e}()},{key:"setConsumerPriority",value:function(){function e(e,r){return t.apply(this,arguments)}var t=h(ke.mark(function e(t,r){return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("setConsumerPriority() [consumerId:%s, priority:%d]",t,r),e.prev=1,e.next=4,this._protoo.request("setConsumerPriority",{consumerId:t,priority:r});case 4:this.store.commit("zeyeClient/consumers/setConsumerPriority",{consumerId:t,priority:r}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),console.error("setConsumerPriority() | failed:%o",e.t0),this.store.dispatch("zeyeClient/notify",{type:"error",text:"Error setting Consumer priority: ".concat(e.t0)});case 11:case"end":return e.stop()}},e,this,[[1,7]])}));return e}()},{key:"requestConsumerKeyFrame",value:function(){function e(e){return t.apply(this,arguments)}var t=h(ke.mark(function e(t){return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("requestConsumerKeyFrame() [consumerId:%s]",t),e.prev=1,e.next=4,this._protoo.request("requestConsumerKeyFrame",{consumerId:t});case 4:this.store.dispatch("zeyeClient/notify",{text:"Keyframe requested for video consumer"}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),console.error("requestConsumerKeyFrame() | failed:%o",e.t0),this.store.dispatch("zeyeClient/notify",{type:"error",text:"Error requesting key frame for Consumer: ".concat(e.t0)});case 11:case"end":return e.stop()}},e,this,[[1,7]])}));return e}()},{key:"enableChatDataProducer",value:function(){function e(){return t.apply(this,arguments)}var t=h(ke.mark(function e(){var t=this;return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.debug("enableChatDataProducer()"),this._useDataChannel){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,this._sendTransport.produceData({ordered:!1,maxRetransmits:1,label:"chat",priority:"medium",appData:{info:"my-chat-DataProducer"}});case 6:this._chatDataProducer=e.sent,this.store.commit("zeyeClient/dataProducers/addDataProducer",{dataProducer:{id:this._chatDataProducer.id,sctpStreamParameters:this._chatDataProducer.sctpStreamParameters,label:this._chatDataProducer.label,protocol:this._chatDataProducer.protocol}}),this._chatDataProducer.on("transportclose",function(){t._chatDataProducer=null}),this._chatDataProducer.on("open",function(){console.debug('chat DataProducer "open" event')}),this._chatDataProducer.on("close",function(){console.error('chat DataProducer "close" event'),t._chatDataProducer=null,t.store.dispatch("zeyeClient/notify",{type:"error",text:"Chat DataProducer closed"})}),this._chatDataProducer.on("error",function(e){console.error('chat DataProducer "error" event:%o',e),t.store.dispatch("zeyeClient/notify",{type:"error",text:"Chat DataProducer error: ".concat(e)})}),this._chatDataProducer.on("bufferedamountlow",function(){console.debug('chat DataProducer "bufferedamountlow" event')}),e.next=20;break;case 15:throw e.prev=15,e.t0=e.catch(3),console.error("enableChatDataProducer() | failed:%o",e.t0),this.store.dispatch("zeyeClient/notify",{type:"error",text:"Error enabling chat DataProducer: ".concat(e.t0)}),e.t0;case 20:case"end":return e.stop()}},e,this,[[3,15]])}));return e}()},{key:"enableBotDataProducer",value:function(){function e(){return t.apply(this,arguments)}var t=h(ke.mark(function e(){var t=this;return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.debug("enableBotDataProducer()"),this._useDataChannel){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,this._sendTransport.produceData({ordered:!1,maxPacketLifeTime:2e3,label:"bot",priority:"medium",appData:{info:"my-bot-DataProducer"}});case 6:this._botDataProducer=e.sent,this.store.commit("zeyeClient/dataProducers/addDataProducer",{dataProducer:{id:this._botDataProducer.id,sctpStreamParameters:this._botDataProducer.sctpStreamParameters,label:this._botDataProducer.label,protocol:this._botDataProducer.protocol}}),this._botDataProducer.on("transportclose",function(){t._botDataProducer=null}),this._botDataProducer.on("open",function(){console.debug('bot DataProducer "open" event')}),this._botDataProducer.on("close",function(){console.error('bot DataProducer "close" event'),t._botDataProducer=null,t.store.dispatch("zeyeClient/notify",{type:"error",text:"Bot DataProducer closed"})}),this._botDataProducer.on("error",function(e){console.error('bot DataProducer "error" event:%o',e),t.store.dispatch("zeyeClient/notify",{type:"error",text:"Bot DataProducer error: ".concat(e)})}),this._botDataProducer.on("bufferedamountlow",function(){console.debug('bot DataProducer "bufferedamountlow" event')}),e.next=20;break;case 15:throw e.prev=15,e.t0=e.catch(3),console.error("enableBotDataProducer() | failed:%o",e.t0),this.store.dispatch("zeyeClient/notify",{type:"error",text:"Error enabling bot DataProducer: ".concat(e.t0)}),e.t0;case 20:case"end":return e.stop()}},e,this,[[3,15]])}));return e}()},{key:"sendChatMessage",value:function(e){if(console.debug('sendChatMessage() [text:"%s]',e),!this._chatDataProducer)return void this.store.dispatch("zeyeClient/notify",{type:"error",text:"No chat DataProducer"});try{this._chatDataProducer.send(e)}catch(e){console.error("chat DataProducer.send() failed:%o",e),this.store.dispatch("zeyeClient/notify",{type:"error",text:"chat DataProducer.send() failed: ".concat(e)})}}},{key:"sendBotMessage",value:function(e){if(console.debug('sendBotMessage() [text:"%s]',e),!this._botDataProducer)return void this.store.dispatch("zeyeClient/notify",{type:"error",text:"No bot DataProducer"});try{this._botDataProducer.send(e)}catch(e){console.error("bot DataProducer.send() failed:%o",e),this.store.dispatch("zeyeClient/notify",{type:"error",text:"bot DataProducer.send() failed: ".concat(e)})}}},{key:"changeDisplayName",value:function(){function e(e){return t.apply(this,arguments)}var t=h(ke.mark(function e(t){return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug('changeDisplayName() [displayName:"%s"]',t),c({displayName:t}),e.prev=2,e.next=5,this._protoo.request("changeDisplayName",{displayName:t});case 5:this._displayName=t,this.store.commit("zeyeClient/me/setDisplayName",{displayName:t}),this.store.dispatch("zeyeClient/notify",{text:"Display name changed"}),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(2),console.error("changeDisplayName() | failed: %o",e.t0),this.store.dispatch("zeyeClient/notify",{type:"error",text:"Could not change display name: ".concat(e.t0)}),this.store.commit("zeyeClient/me/setDisplayName",{displayName:!1});case 15:case"end":return e.stop()}},e,this,[[2,10]])}));return e}()},{key:"getSendTransportRemoteStats",value:function(){if(console.debug("getSendTransportRemoteStats()"),this._sendTransport)return this._protoo.request("getTransportStats",{transportId:this._sendTransport.id})}},{key:"getRecvTransportRemoteStats",value:function(){if(console.debug("getRecvTransportRemoteStats()"),this._recvTransport)return this._protoo.request("getTransportStats",{transportId:this._recvTransport.id})}},{key:"getAudioRemoteStats",value:function(){if(console.debug("getAudioRemoteStats()"),this._micProducer)return this._protoo.request("getProducerStats",{producerId:this._micProducer.id})}},{key:"getVideoRemoteStats",value:function(){console.debug("getVideoRemoteStats()");var e=this._webcamProducer||this._shareProducer;if(e)return this._protoo.request("getProducerStats",{producerId:e.id})}},{key:"getConsumerRemoteStats",value:function(e){if(console.debug("getConsumerRemoteStats()"),this._consumers.get(e))return this._protoo.request("getConsumerStats",{consumerId:e})}},{key:"getChatDataProducerRemoteStats",value:function(){console.debug("getChatDataProducerRemoteStats()");var e=this._chatDataProducer;if(e)return this._protoo.request("getDataProducerStats",{dataProducerId:e.id})}},{key:"getBotDataProducerRemoteStats",value:function(){console.debug("getBotDataProducerRemoteStats()");var e=this._botDataProducer;if(e)return this._protoo.request("getDataProducerStats",{dataProducerId:e.id})}},{key:"getDataConsumerRemoteStats",value:function(e){if(console.debug("getDataConsumerRemoteStats()"),this._dataConsumers.get(e))return this._protoo.request("getDataConsumerStats",{dataConsumerId:e})}},{key:"getSendTransportLocalStats",value:function(){if(console.debug("getSendTransportLocalStats()"),this._sendTransport)return this._sendTransport.getStats()}},{key:"getRecvTransportLocalStats",value:function(){if(console.debug("getRecvTransportLocalStats()"),this._recvTransport)return this._recvTransport.getStats()}},{key:"getAudioLocalStats",value:function(){if(console.debug("getAudioLocalStats()"),this._micProducer)return this._micProducer.getStats()}},{key:"getVideoLocalStats",value:function(){console.debug("getVideoLocalStats()");var e=this._webcamProducer||this._shareProducer;if(e)return e.getStats()}},{key:"getConsumerLocalStats",value:function(e){var t=this._consumers.get(e);if(t)return t.getStats()}},{key:"applyNetworkThrottle",value:function(){function e(e){return t.apply(this,arguments)}var t=h(ke.mark(function e(t){var r,n,o,a;return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.uplink,n=t.downlink,o=t.rtt,a=t.secret,console.debug("applyNetworkThrottle() [uplink:%s, downlink:%s, rtt:%s]",r,n,o),e.prev=2,e.next=5,this._protoo.request("applyNetworkThrottle",{uplink:r,downlink:n,rtt:o,secret:a});case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(2),console.error("applyNetworkThrottle() | failed:%o",e.t0),this.store.dispatch("zeyeClient/notify",{type:"error",text:"Error applying network throttle: ".concat(e.t0)});case 11:case"end":return e.stop()}},e,this,[[2,7]])}));return e}()},{key:"resetNetworkThrottle",value:function(){function e(e){return t.apply(this,arguments)}var t=h(ke.mark(function e(t){var r,n,o;return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.silent,n=void 0!==r&&r,o=t.secret,console.debug("resetNetworkThrottle()"),e.prev=2,e.next=5,this._protoo.request("resetNetworkThrottle",{secret:o});case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),n||(console.error("resetNetworkThrottle() | failed:%o",e.t0),this.store.dispatch("zeyeClient/notify",{type:"error",text:"Error resetting network throttle: ".concat(e.t0)}));case 10:case"end":return e.stop()}},e,this,[[2,7]])}));return e}()},{key:"_joinRoom",value:function(){function e(){return t.apply(this,arguments)}var t=h(ke.mark(function e(){var t,r,n,a,i,s,c,d,l,p,m,f,v,y,b,g,C,_,P,x,S,z,M=this;return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("_joinRoom()"),e.prev=1,this._mediasoupDevice=new o.Device({handlerName:this._handlerName}),e.next=5,this._protoo.request("getRouterRtpCapabilities");case 5:return t=e.sent,e.next=8,this._mediasoupDevice.load({routerRtpCapabilities:t});case 8:return e.next=10,navigator.mediaDevices.getUserMedia({audio:!0});case 10:if(r=e.sent,n=r.getAudioTracks()[0],n.enabled=!1,setTimeout(function(){return n.stop()},12e4),!this._produce){e.next=23;break}return e.next=17,this._protoo.request("createWebRtcTransport",{forceTcp:this._forceTcp,producing:!0,consuming:!1,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 17:a=e.sent,i=a.id,s=a.iceParameters,c=a.iceCandidates,d=a.dtlsParameters,l=a.sctpParameters,this._sendTransport=this._mediasoupDevice.createSendTransport({id:i,iceParameters:s,iceCandidates:c,dtlsParameters:d,sctpParameters:l,iceServers:[],proprietaryConstraints:xe}),this._sendTransport.on("connect",function(e,t,r){var n=e.dtlsParameters;M._protoo.request("connectWebRtcTransport",{transportId:M._sendTransport.id,dtlsParameters:n}).then(t).catch(r)}),this._sendTransport.on("produce",function(){var e=h(ke.mark(function e(t,r,n){var o,a,i,s,c;return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.kind,a=t.rtpParameters,i=t.appData,e.prev=1,e.next=4,M._protoo.request("produce",{transportId:M._sendTransport.id,kind:o,rtpParameters:a,appData:i});case 4:s=e.sent,c=s.id,r({id:c}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),n(e.t0);case 12:case"end":return e.stop()}},e,null,[[1,9]])}));return function(t,r,n){return e.apply(this,arguments)}}()),this._sendTransport.on("producedata",function(){var e=h(ke.mark(function e(t,r,n){var o,a,i,s,c,u;return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.sctpStreamParameters,a=t.label,i=t.protocol,s=t.appData,console.debug('"producedata" event: [sctpStreamParameters:%o, appData:%o]',o,s),e.prev=2,e.next=5,M._protoo.request("produceData",{transportId:M._sendTransport.id,sctpStreamParameters:o,label:a,protocol:i,appData:s});case 5:c=e.sent,u=c.id,r({id:u}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),n(e.t0);case 13:case"end":return e.stop()}},e,null,[[2,10]])}));return function(t,r,n){return e.apply(this,arguments)}}());case 23:if(!this._consume){e.next=30;break}return e.next=26,this._protoo.request("createWebRtcTransport",{forceTcp:this._forceTcp,producing:!1,consuming:!0,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 26:p=e.sent,m=p.id,f=p.iceParameters,v=p.iceCandidates,y=p.dtlsParameters,b=p.sctpParameters,this._recvTransport=this._mediasoupDevice.createRecvTransport({id:m,iceParameters:f,iceCandidates:v,dtlsParameters:y,sctpParameters:b,iceServers:[]}),this._recvTransport.on("connect",function(e,t,r){var n=e.dtlsParameters;M._protoo.request("connectWebRtcTransport",{transportId:M._recvTransport.id,dtlsParameters:n}).then(t).catch(r)});case 30:return e.next=32,this._protoo.request("join",{displayName:this._displayName,device:this._device,rtpCapabilities:this._consume?this._mediasoupDevice.rtpCapabilities:void 0,sctpCapabilities:this._useDataChannel&&this._consume?this._mediasoupDevice.sctpCapabilities:void 0});case 32:g=e.sent,C=g.peers,this.store.commit("zeyeClient/room/setRoomState",{state:"connected"}),this.store.commit("zeyeClient/notifications/removeAllNotifications"),this.store.dispatch("zeyeClient/notify",{text:"You are in the room!",timeout:3e3}),_=k(C);try{for(_.s();!(P=_.n()).done;)x=P.value,this.store.commit("zeyeClient/peers/addPeer",{peer:w({},x,{consumers:[],dataConsumers:[]})})}catch(e){_.e(e)}finally{_.f()}this._produce&&(this.store.commit("zeyeClient/me/setMediaCapabilities",{canSendMic:this._mediasoupDevice.canProduce("audio"),canSendWebcam:this._mediasoupDevice.canProduce("video")}),this.enableMic(),S=u(),(!S||S.webcamEnabled||this._externalVideo)&&this.enableWebcam(),this._sendTransport.on("connectionstatechange",function(e){"connected"===e&&(M.enableChatDataProducer(),M.enableBotDataProducer())})),window.SHOW_INFO&&(z=this.store.state.me,this.store.commit("zeyeClient/room/setRoomStatsPeerId",{peerId:z.id})),e.next=48;break;case 43:e.prev=43,e.t0=e.catch(1),console.error("_joinRoom() failed:%o",e.t0),this.store.dispatch("zeyeClient/notify",{type:"error",text:"Could not join the room: ".concat(e.t0)}),this.close();case 48:case"end":return e.stop()}},e,this,[[1,43]])}));return e}()},{key:"_updateWebcams",value:function(){function e(){return t.apply(this,arguments)}var t=h(ke.mark(function e(){var t,r,n,o,a,i,s;return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("_updateWebcams()"),this._webcams=new Map,console.debug("_updateWebcams() | calling enumerateDevices()"),e.next=5,navigator.mediaDevices.enumerateDevices();case 5:t=e.sent,r=k(t),e.prev=7,r.s();case 9:if((n=r.n()).done){e.next=16;break}if(o=n.value,"videoinput"===o.kind){e.next=13;break}return e.abrupt("continue",14);case 13:this._webcams.set(o.deviceId,o);case 14:e.next=9;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(7),r.e(e.t0);case 21:return e.prev=21,r.f(),e.finish(21);case 24:a=Array.from(this._webcams.values()),i=a.length,s=this._webcam.device?this._webcam.device.deviceId:void 0,console.debug("_updateWebcams() [webcams:%o]",a),0===i?this._webcam.device=null:this._webcams.has(s)||(this._webcam.device=a[0]),this.store.commit("zeyeClient/me/setCanChangeWebcam",{flag:this._webcams.size>1});case 30:case"end":return e.stop()}},e,this,[[7,18,21,24]])}));return e}()},{key:"_getWebcamType",value:function(e){return/(back|rear)/i.test(e.label)?(console.debug("_getWebcamType() | it seems to be a back camera"),"back"):(console.debug("_getWebcamType() | it seems to be a front camera"),"front")}},{key:"_pauseConsumer",value:function(){function e(e){return t.apply(this,arguments)}var t=h(ke.mark(function e(t){return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.paused){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this._protoo.request("pauseConsumer",{consumerId:t.id});case 5:t.pause(),this.store.commit("zeyeClient/consumers/setConsumerPaused",{consumerId:t.id,originator:"local"}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),console.error("_pauseConsumer() | failed:%o",e.t0),this.store.dispatch("zeyeClient/notify",{type:"error",text:"Error pausing Consumer: ".concat(e.t0)});case 13:case"end":return e.stop()}},e,this,[[2,9]])}));return e}()},{key:"_resumeConsumer",value:function(){function e(e){return t.apply(this,arguments)}var t=h(ke.mark(function e(t){return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.paused){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this._protoo.request("resumeConsumer",{consumerId:t.id});case 5:t.resume(),this.store.commit("zeyeClient/consumers/setConsumerResumed",{consumerId:t.id,originator:"local"}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),console.error("_resumeConsumer() | failed:%o",e.t0),this.store.dispatch("zeyeClient/notify",{type:"error",text:"Error resuming Consumer: ".concat(e.t0)});case 13:case"end":return e.stop()}},e,this,[[2,9]])}));return e}()},{key:"_getExternalVideoStream",value:function(){function e(){return t.apply(this,arguments)}var t=h(ke.mark(function e(){var t=this;return ke.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._externalVideoStream){e.next=2;break}return e.abrupt("return",this._externalVideoStream);case 2:if(!(this._externalVideo.readyState<3)){e.next=5;break}return e.next=5,new Promise(function(e){return t._externalVideo.addEventListener("canplay",e)});case 5:if(!this._externalVideo.captureStream){e.next=9;break}this._externalVideoStream=this._externalVideo.captureStream(),e.next=14;break;case 9:if(!this._externalVideo.mozCaptureStream){e.next=13;break}this._externalVideoStream=this._externalVideo.mozCaptureStream(),e.next=14;break;case 13:throw new Error("video.captureStream() not supported");case 14:return e.abrupt("return",this._externalVideoStream);case 15:case"end":return e.stop()}},e,this)}));return e}()}]),e}(),De={props:{peerId:{type:String,required:!0},showVolumeBar:{type:Boolean,default:!1},volumeBarColor:{type:String,default:"greenyellow"}},data:function(){return{hark:null,audioVolume:0}},mounted:function(){this.waitForProducerAvailability()},methods:{runAudio:function(){var e=this.$zeyeClient.getAudioProducer().track;if(e){var t=this.$refs.audioElem;t.muted=!0;var r=new MediaStream;r.addTrack(e),t.srcObject=r,t.play().catch(function(e){return console.warn("audioElem.play() failed:%o",e)}),this._runHark(r)}},runVideo:function(){var e=this.$zeyeClient.getVideoProducer().track;if(e&&this.$zeyeClient.getVideoProducer().track){var t=this.$refs,r=t.audioElem,n=t.videoElem;n.muted=!0;var o=new MediaStream;o.addTrack(e),n.srcObject=o,n.onplay=function(){r.play().catch(function(e){return console.warn("audioElem.play() failed:%o",e)})},n.play()}},_runHark:function(e){var t=this;if(!e.getAudioTracks()[0])throw new Error("_runHark() | given stream has no audio track");this.hark=a(e,{play:!1}),this.hark.on("volume_change",function(e,r){var n=Math.round(10*Math.pow(10,e/85));1===n&&(n=0),n!==t.audioVolume&&(t.audioVolume=n)})},waitForProducerAvailability:function(){this.$zeyeClient.getAudioProducer()&&this.$zeyeClient.getVideoProducer()?(this.runAudio(),this.runVideo()):(console.debug("Waiting for channels availability"),setTimeout(this.waitForProducerAvailability,200))}}},Te=O,Oe="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase()),Ee=document.head||document.getElementsByTagName("head")[0],Ne={},Re=E;const Ae=De;var Fe=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"zeye-peer-media",class:{"active-speaker":e.$zeyeClient.isSpeakerActive(e.peerId)}},[r("video",{ref:"videoElem",staticStyle:{width:"100%"},attrs:{autoPlay:"",muted:"",controls:!1},domProps:{muted:!0}}),e._v(" "),r("audio",{ref:"audioElem",staticStyle:{width:"100%"},attrs:{autoPlay:"",muted:"",controls:!1}}),e._v(" "),e.showVolumeBar?r("div",{staticClass:"volume-container"},[r("div",{staticClass:"bar",style:{height:10*e.audioVolume+"%",backgroundColor:e.volumeBarColor}})]):e._e()])},Le=[];const Be=function(e){e&&e("data-v-2f296856_0",{source:".volume-container{position:absolute;top:0;bottom:0;width:10px;display:flex;-webkit-box-orient:vertical;flex-direction:column;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;pointer-events:none}.volume-container .bar{width:6px;border-radius:6px;transition:.1s ease-in 0s}.zeye-peer-media{position:relative;flex:100 100 auto;display:flex}.zeye-peer-media.active-speaker{box-shadow:0 0 5px #adff2f}",map:void 0,media:void 0})};var Ve=Te({render:Fe,staticRenderFns:Le},Be,Ae,void 0,!1,void 0,Re,void 0),We={install:function(e,t){t.registerModule(["zeyeClient","consumers"],F),t.registerModule(["zeyeClient","dataConsumers"],V),t.registerModule(["zeyeClient","dataProducers"],$),t.registerModule(["zeyeClient","index"],U),t.registerModule(["zeyeClient","me"],K),t.registerModule(["zeyeClient","notifications"],Y),t.registerModule(["zeyeClient","peers"],ee),t.registerModule(["zeyeClient","producers"],ne),t.registerModule(["zeyeClient","room"],ie),this.$zeyeClient=new Ie({store:t}),e.prototype.$zeyeClient=this.$zeyeClient,e.$zeyeClient=this.$zeyeClient,e.component("zeye-peer-media",Ve),D({app:this,store:t})}};return"undefined"!=typeof window&&window.Vue&&window.Vue.use(We),We});